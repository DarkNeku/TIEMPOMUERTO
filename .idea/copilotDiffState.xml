<?xml version="1.0" encoding="UTF-8"?>
<project version="4">
  <component name="CopilotDiffPersistence">
    <option name="pendingDiffs">
      <map>
        <entry key="$PROJECT_DIR$/TIEMPOMUERTO/SCRIPT/CREAR_SALA.gd">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/TIEMPOMUERTO/SCRIPT/CREAR_SALA.gd" />
              <option name="originalContent" value="extends Node2D&#10;&#10;&#10;&#10;func on_btn_crear_sala_pressed():&#10;&#9;var nombre_sala = $Panel/TXT_SALA.text&#10;&#9;var nombre_usuario = $Panel/TXT_NOMBRE.text&#10;&#10;&#10;&#10;&#10;&#10;&#10;&#10;&#10;" />
              <option name="updatedContent" value="extends Node2D&#10;&#10;func _ready():&#10;&#9;$Panel/BTN_VOLVER.connect(&quot;pressed&quot;, Callable(self, &quot;on_btn_volver_pressed&quot;))&#10;&#9;$Panel/BTN_CREAR_SALA.connect(&quot;pressed&quot;, Callable(self, &quot;on_btn_crear_sala_pressed&quot;))&#10;&#10;func on_btn_volver_pressed():&#10;&#9;get_tree().change_scene_to_file(&quot;res://SCENE/MAIN_MENU.tscn&quot;)&#10;&#10;func on_btn_crear_sala_pressed():&#10;&#9;var nombre_sala = $Panel/TXT_SALA.text&#10;&#9;var nombre_usuario = $Panel/TXT_NOMBRE.text&#10;&#9;if Network.start_host():&#10;&#9;&#9;# Llama directamente a la función en lugar de usar RPC (eres el host)&#10;&#9;&#9;Network.salas[nombre_sala] = []&#10;&#9;&#9;Network.jugadores[nombre_sala] = [nombre_usuario]&#10;&#9;&#9;Network.sala_actual = nombre_sala&#10;&#9;&#9;print(&quot;Sala creada: &quot; + nombre_sala)&#10;&#9;&#9;print(&quot;Usuario creado: &quot; + nombre_usuario)&#10;&#9;&#9;if Network.peer:&#10;&#9;&#9;&#9;print(&quot;Peer ID host: &quot; + str(Network.peer.get_unique_id()))&#10;&#9;&#9;var jugadores = Network.get_jugadores(nombre_sala)&#10;&#9;&#9;print(&quot;Jugadores en la sala: &quot; + str(jugadores))&#10;&#9;&#9;if jugadores.size() &gt; 0:&#10;&#9;&#9;&#9;for jugador in jugadores:&#10;&#9;&#9;&#9;&#9;print(&quot;Usuario en sala: &quot; + jugador)&#10;&#9;&#9;else:&#10;&#9;&#9;&#9;print(&quot;ERROR: No se agregó el usuario correctamente!&quot;)&#10;&#9;&#9;get_tree().change_scene_to_file(&quot;res://SCENE/LOBBY.tscn&quot;)&#10;&#9;else:&#10;&#9;&#9;print(&quot;No se pudo iniciar el servidor&quot;)&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/TIEMPOMUERTO/SCRIPT/Global.gd">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/TIEMPOMUERTO/SCRIPT/Global.gd" />
              <option name="originalContent" value="&#10;" />
              <option name="updatedContent" value="extends Node&#10;&#10;var nombre_sala: String = &quot;&quot;&#10;var jugadores: Array = []&#10;&#10;# Puedes agregar más variables globales aquí para el juego" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/TIEMPOMUERTO/SCRIPT/LOBBY.gd">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/TIEMPOMUERTO/SCRIPT/LOBBY.gd" />
              <option name="originalContent" value="extends Node2D&#10;&#10;&#10;&#10;&#10;&#10;&#10;&#10;&#10;&#10;&#10;&#10;&#10;&#10;&#10;" />
              <option name="updatedContent" value="extends Node2D&#10;&#10;var timer: Timer&#10;&#10;func _ready():&#10;&#9;$Panel/NOMBRE_SALA.text = Network.sala_actual&#10;&#9;&#10;&#9;# Si no soy el host, solicitar la lista actualizada de jugadores&#10;&#9;if !Network.soy_host():&#10;&#9;&#9;print(&quot;=== CLIENTE: Solicitando lista de jugadores al host...&quot;)&#10;&#9;&#9;await get_tree().create_timer(0.5).timeout&#10;&#9;&#9;Network.pedir_jugadores.rpc_id(1, Network.sala_actual)&#10;&#9;&#9;await get_tree().create_timer(0.5).timeout&#10;&#9;&#10;&#9;mostrar_jugadores(Network.sala_actual)&#10;&#9;var jugadores = Network.get_jugadores(Network.sala_actual)&#10;&#9;print(&quot;Jugadores en lobby: &quot;, jugadores)&#10;&#9;if jugadores.size() &gt; 0:&#10;&#9;&#9;for jugador in jugadores:&#10;&#9;&#9;&#9;print(&quot;Usuario en lobby: &quot; + jugador)&#10;&#9;else:&#10;&#9;&#9;print(&quot;No hay usuarios en la sala todavía.&quot;)&#10;&#9;print(&quot;Sala actual: &quot; + Network.sala_actual)&#10;&#9;if Network.peer:&#10;&#9;&#9;print(&quot;Peer ID: &quot; + str(Network.peer.get_unique_id()))&#10;&#9;# Timer para refrescar la lista&#10;&#9;if !has_node(&quot;Timer&quot;):&#10;&#9;&#9;timer = Timer.new()&#10;&#9;&#9;timer.wait_time = 1.0&#10;&#9;&#9;timer.autostart = true&#10;&#9;&#9;timer.one_shot = false&#10;&#9;&#9;timer.connect(&quot;timeout&quot;, Callable(self, &quot;_on_timer_timeout&quot;))&#10;&#9;&#9;add_child(timer)&#10;&#10;func _on_timer_timeout():&#10;&#9;mostrar_jugadores(Network.sala_actual)&#10;&#10;func mostrar_jugadores(nombre_sala):&#10;&#9;$Panel/LISTA_JUGADORES.clear()&#10;&#9;var jugadores = Network.get_jugadores(nombre_sala)&#10;&#9;for jugador in jugadores:&#10;&#9;&#9;$Panel/LISTA_JUGADORES.add_item(jugador)&#10;&#10;&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/TIEMPOMUERTO/SCRIPT/MAIN_MENU.gd">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/TIEMPOMUERTO/SCRIPT/MAIN_MENU.gd" />
              <option name="originalContent" value="extends Node2D&#10;&#10;" />
              <option name="updatedContent" value="extends Node2D&#10;&#10;func _ready():&#10;    $Panel/BTN_CREAR.connect(&quot;pressed&quot;, Callable(self, &quot;on_btn_crear_pressed&quot;))&#10;    $Panel/BTN_UNIRSE.connect(&quot;pressed&quot;, Callable(self, &quot;on_btn_unirse_pressed&quot;))&#10;&#10;func on_btn_crear_pressed():&#10;    get_tree().change_scene_to_file(&quot;res://SCENE/CREAR_SALA.tscn&quot;)&#10;&#10;func on_btn_unirse_pressed():&#10;    get_tree().change_scene_to_file(&quot;res://SCENE/UNIRSE_SALA.tscn&quot;)" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/TIEMPOMUERTO/SCRIPT/Network.gd">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/TIEMPOMUERTO/SCRIPT/Network.gd" />
              <option name="originalContent" value="&#10;&#10;&#10;&#10;&#10;&#10;&#10;&#10;&#10;" />
              <option name="updatedContent" value="extends Node&#10;&#10;var salas: Dictionary = {}&#10;var jugadores: Dictionary = {}&#10;var peer: MultiplayerPeer = null&#10;var sala_actual: String = &quot;&quot;&#10;&#10;func start_host(port: int = 12345) -&gt; bool:&#10;&#9;peer = ENetMultiplayerPeer.new()&#10;&#9;var result = peer.create_server(port, 5)&#10;&#9;if result != OK:&#10;&#9;&#9;return false&#10;&#9;multiplayer.multiplayer_peer = peer&#10;&#9;return true&#10;&#10;func connect_to_host(ip: String, port: int = 12345) -&gt; bool:&#10;&#9;peer = ENetMultiplayerPeer.new()&#10;&#9;var result = peer.create_client(ip, port)&#10;&#9;if result != OK:&#10;&#9;&#9;return false&#10;&#9;multiplayer.multiplayer_peer = peer&#10;&#9;return true&#10;&#10;@rpc(&quot;authority&quot;)&#10;func crear_sala(nombre_sala: String, nombre_usuario: String):&#10;&#9;salas[nombre_sala] = []&#10;&#9;jugadores[nombre_sala] = [nombre_usuario]&#10;&#9;sala_actual = nombre_sala&#10;&#9;sync_salas.rpc(salas)&#10;&#9;sync_jugadores.rpc(jugadores)&#10;&#10;@rpc(&quot;any_peer&quot;)&#10;func unirse_sala(nombre_sala: String, nombre_usuario: String):&#10;&#9;if soy_host():&#10;&#9;&#9;if nombre_sala in jugadores:&#10;&#9;&#9;&#9;jugadores[nombre_sala].append(nombre_usuario)&#10;&#9;&#9;&#9;print(&quot;=== HOST: Usuario &quot; + nombre_usuario + &quot; se unió a la sala: &quot; + nombre_sala)&#10;&#9;&#9;&#9;print(&quot;=== HOST: Jugadores actuales: &quot; + str(jugadores[nombre_sala]))&#10;&#9;&#9;&#9;# Sincronizar con todos los peers&#10;&#9;&#9;&#9;sync_jugadores.rpc(jugadores)&#10;&#9;&#9;&#9;print(&quot;=== HOST: Lista de jugadores sincronizada con todos los peers&quot;)&#10;&#9;&#9;else:&#10;&#9;&#9;&#9;print(&quot;=== HOST ERROR: La sala &quot; + nombre_sala + &quot; no existe!&quot;)&#10;&#9;else:&#10;&#9;&#9;print(&quot;=== CLIENTE: Intentando unirse, pero no soy host&quot;)&#10;&#10;func get_salas() -&gt; Array:&#10;&#9;return salas.keys()&#10;&#10;func get_jugadores(nombre_sala: String) -&gt; Array:&#10;&#9;if nombre_sala in jugadores:&#10;&#9;&#9;return jugadores[nombre_sala]&#10;&#9;return []&#10;&#10;func soy_host() -&gt; bool:&#10;&#9;return multiplayer.is_server()&#10;&#10;@rpc(&quot;any_peer&quot;)&#10;func sync_salas(salas_dict: Dictionary):&#10;&#9;salas = salas_dict&#10;&#10;@rpc(&quot;any_peer&quot;)&#10;func sync_jugadores(jugadores_dict: Dictionary):&#10;&#9;jugadores = jugadores_dict&#10;&#9;print(&quot;=== SYNC: Lista de jugadores actualizada: &quot; + str(jugadores))&#10;&#10;@rpc(&quot;any_peer&quot;)&#10;func pedir_salas():&#10;&#9;if soy_host():&#10;&#9;&#9;sync_salas.rpc_id(multiplayer.get_remote_sender_id(), salas)&#10;&#10;@rpc(&quot;any_peer&quot;)&#10;func pedir_jugadores(_nombre_sala: String):&#10;&#9;if soy_host():&#10;&#9;&#9;sync_jugadores.rpc_id(multiplayer.get_remote_sender_id(), jugadores)&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/TIEMPOMUERTO/SCRIPT/UNIRSE_SALA.gd">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/TIEMPOMUERTO/SCRIPT/UNIRSE_SALA.gd" />
              <option name="originalContent" value="extends Node2D&#10;&#10;&#10;&#10;&#10;&#10;&#10;&#10;" />
              <option name="updatedContent" value="extends Node2D&#10;&#10;var timer: Timer&#10;var conectado: bool = false&#10;&#10;func _ready():&#10;&#9;$Panel/BTN_VOLVER.connect(&quot;pressed&quot;, Callable(self, &quot;on_btn_volver_pressed&quot;))&#10;&#9;$Panel/BTN_UNIRSE_SALA.connect(&quot;pressed&quot;, Callable(self, &quot;on_btn_unirse_sala_pressed&quot;))&#10;&#10;&#9;# Conectar al host automáticamente al entrar&#10;&#9;var ip_host = &quot;127.0.0.1&quot; # IP del host (localhost para pruebas)&#10;&#9;if Network.connect_to_host(ip_host):&#10;&#9;&#9;print(&quot;Conectado al host en: &quot; + ip_host)&#10;&#9;&#9;conectado = true&#10;&#9;&#9;# Esperar un momento para que la conexión se establezca&#10;&#9;&#9;await get_tree().create_timer(0.5).timeout&#10;&#9;&#9;# Solicitar la lista de salas al host&#10;&#9;&#9;Network.pedir_salas.rpc_id(1)&#10;&#9;else:&#10;&#9;&#9;print(&quot;No se pudo conectar al host&quot;)&#10;&#10;&#9;mostrar_salas()&#10;&#10;&#9;# Timer para refrescar la lista de salas&#10;&#9;timer = Timer.new()&#10;&#9;timer.wait_time = 1.0&#10;&#9;timer.autostart = true&#10;&#9;timer.one_shot = false&#10;&#9;timer.connect(&quot;timeout&quot;, Callable(self, &quot;on_timer_timeout&quot;))&#10;&#9;add_child(timer)&#10;&#10;func on_timer_timeout():&#10;&#9;if conectado:&#10;&#9;&#9;Network.pedir_salas.rpc_id(1)&#10;&#9;mostrar_salas()&#10;&#10;func mostrar_salas():&#10;&#9;$Panel/LISTA_SALA.clear()&#10;&#9;var salas = Network.get_salas()&#10;&#9;print(&quot;Salas disponibles: &quot; + str(salas))&#10;&#9;for sala in salas:&#10;&#9;&#9;$Panel/LISTA_SALA.add_item(sala)&#10;&#10;func on_btn_volver_pressed():&#10;&#9;get_tree().change_scene_to_file(&quot;res://SCENE/MAIN_MENU.tscn&quot;)&#10;&#10;func on_btn_unirse_sala_pressed():&#10;&#9;# Verificar que los nodos existan&#10;&#9;if not has_node(&quot;Panel/TXT_NOMBRE&quot;):&#10;&#9;&#9;print(&quot;ERROR: No se encontró el nodo Panel/TXT_NOMBRE&quot;)&#10;&#9;&#9;print(&quot;Estructura de nodos disponible:&quot;)&#10;&#9;&#9;print_tree_pretty()&#10;&#9;&#9;return&#10;&#9;&#10;&#9;if not has_node(&quot;Panel/LISTA_SALA&quot;):&#10;&#9;&#9;print(&quot;ERROR: No se encontró el nodo Panel/LISTA_SALA&quot;)&#10;&#9;&#9;return&#10;&#9;&#10;&#9;var nombre_usuario = $Panel/TXT_NOMBRE.text&#10;&#9;&#10;&#9;# Validar que el nombre de usuario no esté vacío&#10;&#9;if nombre_usuario.strip_edges() == &quot;&quot;:&#10;&#9;&#9;print(&quot;ERROR: Debes ingresar un nombre de usuario&quot;)&#10;&#9;&#9;return&#10;&#9;&#10;&#9;var sala_seleccionada = $Panel/LISTA_SALA.get_selected_items()&#10;&#10;&#9;if sala_seleccionada.size() &gt; 0:&#10;&#9;&#9;var nombre_sala = $Panel/LISTA_SALA.get_item_text(sala_seleccionada[0])&#10;&#9;&#9;print(&quot;Uniéndose a la sala: &quot; + nombre_sala)&#10;&#9;&#9;print(&quot;Usuario: &quot; + nombre_usuario)&#10;&#10;&#9;&#9;# Enviar al host la solicitud de unirse&#10;&#9;&#9;Network.unirse_sala.rpc_id(1, nombre_sala, nombre_usuario)&#10;&#9;&#9;Network.sala_actual = nombre_sala&#10;&#10;&#9;&#9;# Ir al lobby&#10;&#9;&#9;get_tree().change_scene_to_file(&quot;res://SCENE/LOBBY.tscn&quot;)&#10;&#9;else:&#10;&#9;&#9;print(&quot;Debes seleccionar una sala primero&quot;)&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/TIEMPOMUERTO/project.godot">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/TIEMPOMUERTO/project.godot" />
              <option name="originalContent" value="; Engine configuration file.&#10;; It's best edited using the editor UI and not directly,&#10;; since the parameters that go here are not all obvious.&#10;;&#10;; Format:&#10;;   [section] ; section goes between []&#10;;   param=value ; assign values to parameters&#10;&#10;config_version=5&#10;&#10;[application]&#10;&#10;config/name=&quot;TIEMPOMUERTO&quot;&#10;run/main_scene=&quot;uid://bgbmm001nwnjv&quot;&#10;config/features=PackedStringArray(&quot;4.4&quot;, &quot;GL Compatibility&quot;)&#10;config/icon=&quot;res://icon.svg&quot;&#10;&#10;[display]&#10;&#10;window/size/viewport_width=1280&#10;window/size/viewport_height=720&#10;window/stretch/mode=&quot;viewport&quot;&#10;&#10;[rendering]&#10;&#10;renderer/rendering_method=&quot;gl_compatibility&quot;&#10;renderer/rendering_method.mobile=&quot;gl_compatibility&quot;&#10;textures/vram_compression/import_etc2_astc=true&#10;" />
              <option name="updatedContent" value="; Engine configuration file.&#10;; It's best edited using the editor UI and not directly,&#10;; since the parameters that go here are not all obvious.&#10;;&#10;; Format:&#10;;   [section] ; section goes between []&#10;;   param=value ; assign values to parameters&#10;&#10;config_version=5&#10;&#10;[application]&#10;&#10;config/name=&quot;TIEMPOMUERTO&quot;&#10;run/main_scene=&quot;uid://bgbmm001nwnjv&quot;&#10;config/features=PackedStringArray(&quot;4.4&quot;, &quot;GL Compatibility&quot;)&#10;config/icon=&quot;res://icon.svg&quot;&#10;&#10;[autoload]&#10;Global=&quot;*res://SCRIPT/Global.gd&quot;&#10;&#10;[display]&#10;&#10;window/size/viewport_width=1280&#10;window/size/viewport_height=720&#10;window/stretch/mode=&quot;viewport&quot;&#10;&#10;[rendering]&#10;&#10;renderer/rendering_method=&quot;gl_compatibility&quot;&#10;renderer/rendering_method.mobile=&quot;gl_compatibility&quot;&#10;textures/vram_compression/import_etc2_astc=true" />
            </PendingDiffInfo>
          </value>
        </entry>
      </map>
    </option>
  </component>
</project>